
{% assign collections = site.data.collections-data ' %}

<script>
    var allCollections = [
        {% for c in collections %}{ "path":{{ c.path | jsonify }}, {% if c.path and c.cdmid and c.path != c.cdmid %}"cdmid":{{ c.cdmid | jsonify }}{% else %}"cdmid":""{% endif%}, {% if c.path == 'lumber' %}"digital":""{% else %}"digital":"digital-"{% endif%}, "title":{{ c.title | jsonify }}}{% unless forloop.last %}, {% endunless %}{% endfor %}
    ];
    function getType() {
        var chosenType = this.value;
        if(chosenType == 'image') {
            // set up image options
            var collectionOptions = allCollections.map(i => `<option value="${i.path}" data-cdmid="${i.cdmid}" data-colltype="${i.digital}">${i.path} - ${i.title}</option>`).join(" ");
            // set image form
            var imageForm = 
                `<div class="form-group">
                    <label for="collectionID">Collection:</label>
                    <select class="custom-select" id="collectionID">
                        <option value="">Select a Collection</option>
                        ${collectionOptions}
                    </select>
                </div>
                <div class="form-group">
                    <label for="itemID">Item ID (i.e. lumber704 or cccidaho220. For multiples separate by semicolon)</label>
                    <input class="form-control" id="itemID" placeholder="Provide the objectid of the image or images">
                </div>
                <div class="form-group">
                    <label for="imageCaption">Image caption (If you want to override the autogenerated caption, which is the item's title):</label>
                    <input class="form-control" id="imageCaption" placeholder="Text caption for image">
                </div>
                <div class="form-group">
                    <label for="imageWidth">Image width (optional):</label>
                    <select class="custom-select" id="imageWidth">
                        <option value="">Select an image width</option>
                        <option value="25">25%</option>
                        <option value="50">50%</option>
                        <option value="75">75%</option>
                        <option value="100">100%</option>
                    </select>
                </div>
                <button type="submit" id="generate" class="btn btn-primary mr-3">Submit</button>
                <button id="reload" class="btn btn-success">Refresh</button>`;

            // add image form to page
            document.getElementById('form-content').innerHTML = imageForm;

            // define button
            var btn = document.getElementById('generate');

            // generate include
            btn.addEventListener('click', function(){
                // get include options, check if blank, and set up in template
                var collection = document.getElementById('collectionID');
                if (collection.value == 'lumber'){
                var includeCollection = "";
                var includeCDM = "";
                var includeDigital = ``;
             
                }
                else {
                var includeCollection = collection.value ? ` collection="${collection.value}"` : "";
                var includeCDM = collection.options[collection.selectedIndex].dataset.cdmid ? ` cdm-collection="${collection.options[collection.selectedIndex].dataset.cdmid}"` : "";
                var includeDigital = `digital-`;}
                var includeObjectid = document.getElementById('itemID').value ? ` objectid="${document.getElementById('itemID').value}"` : "";
                var includeCaption = document.getElementById('imageCaption').value ? ` caption="${document.getElementById('imageCaption').value}"` : "";
                var includeWidth = document.getElementById('imageWidth').value ? ` width="${document.getElementById('imageWidth').value}"` : "";
                // check required options
                if (collection == "") {
                    alert('Please choose a collection!');
                } else if (includeObjectid == "") {
                    alert('Please include the objectid or ids!');
                } else {

                    // set up include code 
                    var include = 
                        `<div class="card">
                            <div class="m-4">
                                <p>
                                    <strong>Include Code </strong><br>
                                    <small class="text-muted">Copy and paste all of the code below into your essay page</small><br>
                                    <code>
                                    {% raw %}{% include feature/${includeDigital}image.html${includeCollection}${includeCDM}${includeCaption}${includeWidth}${includeObjectid} %}{% endraw %}
                                    </code>
                                </p>
                            </div>
                        </div>`;
                    // add to page
                    document.getElementById('include-output').innerHTML = include;
                }
            });

            // refresh button
            document.getElementById('reload').addEventListener('click', function(){
                window.location.reload();
            });

        } else if(chosenType == 'pdf') {
            // set up image options
            var collectionOptions = allCollections.map(i => `<option value="${i.path}" data-cdmid="${i.cdmid}">${i.path} - ${i.title}</option>`).join(" ");
            // set image form
            var pdfForm = 
                `<div class="form-group">
                    <label for="collectionID">Collection:</label>
                    <select class="custom-select" id="collectionID">
                        <option value="">Select a Collection</option>
                        ${collectionOptions}
                    </select>
                </div>
                <div class="form-group">
                    <label for="itemID">Item ID (i.e. lumber704 or cccidaho220. For multiples separate by semicolon)</label>
                    <input class="form-control" id="itemID" placeholder="Provide the objectid of the pdf or pdfs">
                </div>
                <p class="text-right small font-italic"><button class="btn font-italic" type="button" data-toggle="collapse" data-target="#collapseOptions" aria-expanded="false" aria-controls="collapseOptions">Additional Options (Width, Caption Over-ride) &#8597;</button></p>
                <div class="collapse" id="collapseOptions">
                <div class="form-group">
                    <label for="commandType">Type of Inclusion:</label>
                    <select class="custom-select" id="commandType">
                        <option value="embed">Select how you'd like it to be included.</option>
                        <option value="embed">PDF-Embed - Embed the PDF in a PDF Viewer on the Page (default)</option>
                        <option value="image">PDF-Image - Show the First Page of the PDF as a linked image - Not for Lumber -- if you want an image of a PDF for lumber, choose the image option instead</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pdfCaption">PDF caption (If you want to override the autogenerated caption, which is the item's title):</label>
                    <input class="form-control" id="pdfCaption" placeholder="Text caption for image">
                </div>
                <div class="form-group">
                    <label for="pdfWidth">PDF Embed width (optional):</label>
                    <select class="custom-select" id="pdfWidth">
                        <option value="">Select an image width</option>
                        <option value="25">25%</option>
                        <option value="50">50%</option>
                        <option value="75">75%</option>
                        <option value="100">100%</option>
                    </select>
                </div>
                </div>
                <button type="submit" id="generate" class="btn btn-primary mr-3">Submit</button>
                <button id="reload" class="btn btn-success">Refresh</button>`;

            // add image form to page
            document.getElementById('form-content').innerHTML = pdfForm;

            // define button
            var btn = document.getElementById('generate');

            // generate include
            btn.addEventListener('click', function(){
                // get include options, check if blank, and set up in template
                var collection = document.getElementById('collectionID');
                if (collection.value == 'lumber'){
                var includeCollection = "";
                var includeCDM = "";
                var includeDigital = `item-`;
                var includeCommand = "embed";
                }
                else {
                var includeCollection = collection.value ? ` collection="${collection.value}"` : "";
                var includeCDM = collection.options[collection.selectedIndex].dataset.cdmid ? ` cdm-collection="${collection.options[collection.selectedIndex].dataset.cdmid}"` : "";
                var includeCommand= document.getElementById('commandType').value ? `${document.getElementById('commandType').value}` : "";
                var includeDigital = `digital-`;}
                var includeObjectid = document.getElementById('itemID').value ? ` objectid="${document.getElementById('itemID').value}"` : "";
                var includeCaption = document.getElementById('pdfCaption').value ? ` caption="${document.getElementById('pdfCaption').value}"` : "";
                var includeWidth = document.getElementById('pdfWidth').value ? ` width="${document.getElementById('pdfWidth').value}"` : "";
                // check required options
                if (collection == "") {
                    alert('Please choose a collection!');
                } else if (includeObjectid == "") {
                    alert('Please include the objectid or ids!');
                } else if (collection == "lumber"  && includeCommand == "image") {
                    alert('Not going to work! To include an image of a PDF from lumber, just use the image selection instead.');
                } 
                else {

                    // set up include code 
                    var include = 
                        `<div class="card">
                            <div class="m-4">
                                <p>
                                    <strong>Include Code </strong><br>
                                    <small class="text-muted">Copy and paste all of the code below into your essay page</small><br>
                                    <code>
                                    {% raw %}{% include feature/${includeDigital}pdf-${includeCommand}.html${includeCollection}${includeCDM}${includeCaption}${includeWidth}${includeObjectid} %}{% endraw %}
                                    </code>
                                </p>
                            </div>
                        </div>`;
                    // add to page
                    document.getElementById('include-output').innerHTML = include;
                }
            });

            // refresh button
            document.getElementById('reload').addEventListener('click', function(){
                window.location.reload();
            });

        }
        else if(chosenType == 'video') {
            // set up image options
            var collectionOptions = allCollections.map(i => `<option value="${i.path}" data-cdmid="${i.cdmid}">${i.path} - ${i.title}</option>`).join(" ");
            // set image form
            var pdfForm = 
                `<div class="form-group">
                    <label for="collectionID">Collection:</label>
                    <select class="custom-select" id="collectionID">
                        <option value="">Select a Collection</option>
                        ${collectionOptions}
                    </select>
                </div>
                <div class="form-group">
                    <label for="itemID">Item ID (i.e. lumber704 or cccidaho220. For multiples separate by semicolon)</label>
                    <input class="form-control" id="itemID" placeholder="Provide the objectid of the pdf or pdfs">
                </div>
                <p class="text-right small font-italic"><button class="btn font-italic" type="button" data-toggle="collapse" data-target="#collapseOptions" aria-expanded="false" aria-controls="collapseOptions">Additional Options (Width, Caption Over-ride) &#8597;</button></p>
                <div class="collapse" id="collapseOptions">
                <div class="form-group">
                    <label for="commandType">Type of Inclusion:</label>
                    <select class="custom-select" id="commandType">
                        <option value="embed">Select how you'd like it to be included.</option>
                        <option value="embed">PDF-Embed - Embed the PDF in a PDF Viewer on the Page (default)</option>
                        <option value="image">PDF-Image - Show the First Page of the PDF as a linked image - Not for Lumber -- if you want an image of a PDF for lumber, choose the image option instead</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pdfCaption">PDF caption (If you want to override the autogenerated caption, which is the item's title):</label>
                    <input class="form-control" id="pdfCaption" placeholder="Text caption for image">
                </div>
                <div class="form-group">
                    <label for="pdfWidth">PDF Embed width (optional):</label>
                    <select class="custom-select" id="pdfWidth">
                        <option value="">Select an image width</option>
                        <option value="25">25%</option>
                        <option value="50">50%</option>
                        <option value="75">75%</option>
                        <option value="100">100%</option>
                    </select>
                </div>
                </div>
                <button type="submit" id="generate" class="btn btn-primary mr-3">Submit</button>
                <button id="reload" class="btn btn-success">Refresh</button>`;

            // add image form to page
            document.getElementById('form-content').innerHTML = pdfForm;

            // define button
            var btn = document.getElementById('generate');

            // generate include
            btn.addEventListener('click', function(){
                // get include options, check if blank, and set up in template
                var collection = document.getElementById('collectionID');
                if (collection.value == 'lumber'){
                var includeCollection = "";
                var includeCDM = "";
                var includeDigital = `item-`;
                var includeCommand = "embed";
                }
                else {
                var includeCollection = collection.value ? ` collection="${collection.value}"` : "";
                var includeCDM = collection.options[collection.selectedIndex].dataset.cdmid ? ` cdm-collection="${collection.options[collection.selectedIndex].dataset.cdmid}"` : "";
                var includeCommand= document.getElementById('commandType').value ? `${document.getElementById('commandType').value}` : "";
                var includeDigital = `digital-`;}
                var includeObjectid = document.getElementById('itemID').value ? ` objectid="${document.getElementById('itemID').value}"` : "";
                var includeCaption = document.getElementById('pdfCaption').value ? ` caption="${document.getElementById('pdfCaption').value}"` : "";
                var includeWidth = document.getElementById('pdfWidth').value ? ` width="${document.getElementById('pdfWidth').value}"` : "";
                // check required options
                if (collection == "") {
                    alert('Please choose a collection!');
                } else if (includeObjectid == "") {
                    alert('Please include the objectid or ids!');
                } else if (collection == "lumber"  && includeCommand == "image") {
                    alert('Not going to work! To include an image of a PDF from lumber, just use the image selection instead.');
                } 
                else {

                    // set up include code 
                    var include = 
                        `<div class="card">
                            <div class="m-4">
                                <p>
                                    <strong>Include Code </strong><br>
                                    <small class="text-muted">Copy and paste all of the code below into your essay page</small><br>
                                    <code>
                                    {% raw %}{% include feature/${includeDigital}pdf-${includeCommand}.html${includeCollection}${includeCDM}${includeCaption}${includeWidth}${includeObjectid} %}{% endraw %}
                                    </code>
                                </p>
                            </div>
                        </div>`;
                    // add to page
                    document.getElementById('include-output').innerHTML = include;
                }
            });

            // refresh button
            document.getElementById('reload').addEventListener('click', function(){
                window.location.reload();
            });

        }
        else if(chosenType == 'frontmatter') {
            // set up image options
            var collectionOptions = allCollections.map(i => `<option value="${i.path}" data-cdmid="${i.cdmid}">${i.path} - ${i.title}</option>`).join(" ");
            // set image form
            var pdfForm = 
                `<div class="form-group">
                    <label for="postTitle">Post Title:</label>
                    <input class="form-control" id="postTitle" placeholder="Title for your post">
                </div>
                <div class="form-group">
                    <label for="collectionID">Cover Image Collection:</label>
                    <select class="custom-select" id="collectionID">
                        <option value="">Cover Image Collection</option>
                        ${collectionOptions}
                    </select>
                </div>
                <div class="form-group">
                    <label for="itemID">Cover Image ID (i.e. lumber704 or cccidaho220. For multiples separate by semicolon)</label>
                    <input class="form-control" id="itemID" placeholder="Provide the objectid of the pdf or pdfs">
                </div>
                <div class="form-group">
                    <label for="postSubjects">Post Subjects:</label>
                    <div class="row">
                    <input class="form-control col-4" id="postSubject1" placeholder="Subject 1">
                    <input class="form-control col-4" id="postSubject2" placeholder="Subject 2">
                    <input class="form-control col-4" id="postSubject3" placeholder="Subject 3">
                    <input class="form-control col-4" id="postSubject4" placeholder="Subject 4">
                    <input class="form-control col-4" id="postSubject5" placeholder="Subject 5">
                    <input class="form-control col-4" id="postSubject6" placeholder="Subject 6">
                    </div>
                </div>
                <div class="form-group">
                    <label for="postCategory">Post Category:</label>
                    <input class="form-control" id="postCategory" placeholder="Category for your post">

                </div>
                <div class="form-group">
                    <label for="postSubtitle">Post Subtitle:</label>
                    <input class="form-control" id="postSubtitle" placeholder="This is rarely used!">
                </div>
                <br>
                <div class="row">
                <button type="submit" id="generate" class="btn btn-primary mr-3">Submit</button>
                <button id="reload" class="btn btn-success">Refresh</button>
                </div>`;

            // add image form to page
            document.getElementById('form-content').innerHTML = pdfForm;

            // define button
            var btn = document.getElementById('generate');

            // generate include
            btn.addEventListener('click', function(){
                // get include options, check if blank, and set up in template
                var collection = document.getElementById('collectionID');
                if (collection.value == 'lumber'){
                var includeCollection = "";
                var includeCDM = "";
                }
                else {
                var includeCollection = collection.value ? `\r\ncover-image-collection: ${collection.value}` : "";
                var includeCDM = collection.options[collection.selectedIndex].dataset.cdmid ? `\r\ncover-image-cdm-collection: ${collection.options[collection.selectedIndex].dataset.cdmid}` : "";}
                var includeObjectid = document.getElementById('itemID').value ? `${document.getElementById('itemID').value}` : "";
                var includeTitle = document.getElementById('postTitle').value ? `${document.getElementById('postTitle').value}` : "";
                var includeSubtitle = document.getElementById('postSubtitle').value ? `${document.getElementById('postSubtitle').value}` : "";
                var includeCategory = document.getElementById('postCategory').value ? `${document.getElementById('postCategory').value}` : "";
                var includeSubject1 = document.getElementById('postSubject1').value ? `"${document.getElementById('postSubject1').value}"` : "";
                var includeSubject2 = document.getElementById('postSubject2').value ? `,"${document.getElementById('postSubject2').value}"` : "";
                var includeSubject3 = document.getElementById('postSubject3').value ? `,"${document.getElementById('postSubject3').value}"` : "";
                var includeSubject4 = document.getElementById('postSubject4').value ? `,"${document.getElementById('postSubject4').value}"` : "";
                var includeSubject5 = document.getElementById('postSubject5').value ? `,"${document.getElementById('postSubject5').value}"` : "";
                var includeSubject6 = document.getElementById('postSubject6').value ? `,"${document.getElementById('postSubject6').value}"` : "";
                var includeDateTime = new Date().toISOString().slice(0, 10) + ' 04:01:59 -0800';
                // check required options
                if (collection == "") {
                    alert('Please choose a collection!');
                } else if (includeObjectid == "") {
                    alert('Please include the objectid for your cover image');
                } 
                else {

                    // set up include code 
                    var include = 
                        `<div class="card">
                            <div class="m-4">
                                <p>
                                    <strong>Include Code </strong><br>
                                    <small class="text-muted">Copy and paste all of the code below into your essay page</small><br>
<textarea id="frontmatter-val" rows="20" cols="50">{% raw %}
---
title: "${includeTitle}"
date: ${includeDateTime}
tags: [${includeSubject1}${includeSubject2}${includeSubject3}${includeSubject4}${includeSubject5}${includeSubject6}]
subtitle: ${includeSubtitle}
cover-image: ${includeObjectid}${includeCollection}${includeCDM}
categories: [${includeCategory}]
---


{% endraw %}
</textarea>
                                    <br><br><br>
                                    <button type="submit" id="download-markdown" onclick="fileCreate();" class="btn btn-primary m-5">Download Post File</button>
                                </p>
                            </div>
                        </div>`;
                    // add to page
                    document.getElementById('include-output').innerHTML = include;
                }
            });

            // refresh button
            document.getElementById('reload').addEventListener('click', function(){
                window.location.reload();
            });

        }
    };

    var includeSelection = document.getElementById("include-type");
    includeSelection.addEventListener('change', getType);
    
    function download(filename, text) {
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', filename);
    element.style.display = 'none';
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
    }
    function fileCreate(){
    // Generate download of hello.txt file with some content
    var text = document.getElementById("frontmatter-val").value;
    var dateJs = new Date();
    var date = dateJs.toISOString().slice(0, 10);
    var title = document.getElementById("postTitle").value;
    var filetitle = title.replace(/[^a-z0-9]/gi, '-').toLowerCase();
    var filename = date + "-" + filetitle + ".md";
    download(filename, text);
    };
</script>